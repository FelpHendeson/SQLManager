<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SQLManager | Detalhe do script</title>
    <style>
      :root {
        color-scheme: light;
        font-family: "Inter", system-ui, sans-serif;
      }

      body {
        margin: 0;
        background: #f5f5f7;
        color: #1b1b1f;
      }

      header {
        background: #141425;
        color: white;
        padding: 24px 32px;
      }

      main {
        padding: 32px;
        display: grid;
        gap: 24px;
      }

      .card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 8px 24px rgba(20, 20, 37, 0.08);
      }

      .grid {
        display: grid;
        gap: 16px;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      }

      pre {
        background: #0f0f19;
        color: #c8c8ff;
        padding: 16px;
        border-radius: 12px;
        overflow-x: auto;
      }

      .tag {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 999px;
        font-size: 12px;
        background: #efeefe;
        color: #5a4bd1;
        margin-right: 6px;
      }

      a {
        color: #5a4bd1;
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>SQLManager</h1>
      <p>Detalhamento do script importado.</p>
    </header>

    <main>
      <section class="card">
        <h2><%= script.fileName %></h2>
        <p>
          <span class="tag"><%= script.databaseName %></span>
          <span class="tag"><%= script.createdAt %></span>
        </p>
        <p><a href="/">&larr; Voltar</a></p>
      </section>

      <section class="card">
        <h3>Variáveis</h3>
        <% if (script.variables.length === 0) { %>
        <p>Nenhuma variável detectada.</p>
        <% } %>
        <ul>
          <% script.variables.forEach((variable) => { %>
          <li>
            <strong><%= variable.name %></strong> : <%= variable.dataType %>
            <% if (variable.defaultValue) { %>
            (default: <%= variable.defaultValue %>)
            <% } %>
            <% if (variable.isCursorBased) { %>
            <span class="tag">cursor rowtype</span>
            <% } %>
          </li>
          <% }) %>
        </ul>
      </section>

      <section class="card">
        <h3>Cursores</h3>
        <% if (script.cursors.length === 0) { %>
        <p>Nenhum cursor detectado.</p>
        <% } %>
        <% script.cursors.forEach((cursor) => { %>
        <article style="margin-bottom: 24px;">
          <h4><%= cursor.name %></h4>
          <p>
            <span class="tag">Tabelas: <%= cursor.tables.join(", ") || "-" %></span>
            <span class="tag">Colunas: <%= cursor.columns.join(", ") || "-" %></span>
          </p>
          <pre><%= cursor.query %></pre>
        </article>
        <% }) %>
      </section>

      <section class="card">
        <h3>Dependências</h3>
        <% if (script.dependencies.length === 0) { %>
        <p>Sem dependências detectadas.</p>
        <% } %>
        <ul>
          <% script.dependencies.forEach((dependency) => { %>
          <li><strong><%= dependency.type %>:</strong> <%= dependency.name %></li>
          <% }) %>
        </ul>
      </section>

      <section class="card">
        <h3>Blocos detectados</h3>
        <div class="grid">
          <% script.blocks.forEach((block) => { %>
          <div class="card" style="background:#f9f9ff;">
            <span class="tag"><%= block.type %></span>
            <p><%= block.summary %></p>
          </div>
          <% }) %>
        </div>
      </section>

      <section class="card">
        <h3>SQL bruto</h3>
        <pre><%= script.rawSql %></pre>
      </section>
    </main>
  </body>
</html>
